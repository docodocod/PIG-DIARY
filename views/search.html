{% block content %}
<head>
    <title>search</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="/search.css">
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<!--    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>-->
</head>
<div class="container">
    <form id="curruntPosition" action="/user/{{userId}}/aroundMyList" method="post">
        <input type="hidden" id="lat" name="lat" value=""/>
        <input type="hidden" id="lng" name="lng" value=""/>
        <a id="curruntPosition_btn" class="button" >내 주변 맛집 리스트</a>
    </form>
</div>
<div class="container">
    <form id="search" action="/searchPage" method="post">
        <div class="search-container">
        <input type="text" name="searchWord" placeholder="Search..." class="field" />
        <a id="search_btn" class="button" >맛집 찾아보기</a>
        </div>
    </form>
</div>
<div class="container">
    <form id="myPosition" action="/searchPage" method="post">
        <input type="hidden" id="position" name="searchWord" value="" />
        <a id="myPosition_btn" class="button">내 주변 맛집 찾기</a>
    </form>
</div>



{% endblock %}
{% include "footer.html" %}
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=22382396d3cba032b99b1fcc9ec5b4f1&libraries=services"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    document.getElementById("search_btn").addEventListener("click",()=>{
       const search=$("#search");
       search.submit();
    });

    document.getElementById("myPosition_btn").addEventListener("click",(e)=> {
        e.preventDefault();

        function success(pos) { // 위치 정보를 가져오는데 성공했을 때 호출되는 콜백 함수 (pos : 위치 정보 객체)
            getMyPosition(pos.coords.latitude, pos.coords.longitude);
        }

        function fail(err) { // 위치 정보를 가져오는데 실패했을 때 호출되는 콜백 함수
            alert('현위치를 찾을 수 없습니다.');
        }

        navigator.geolocation.getCurrentPosition(success, fail);

        function getMyPosition(lat, lng) {
            console.log(lat, lng);
            var geocoder = new kakao.maps.services.Geocoder();

            var coord = new kakao.maps.LatLng(lat, lng);
            var callback = function (result, status) {
                if (status === kakao.maps.services.Status.OK) {
                    const position = document.getElementById("position");
                    const name = result[0].address.address_name + " 맛집";
                    position.value = name;
                    const myPosition = document.getElementById('myPosition');
                    myPosition.submit();
                }
            };
            geocoder.coord2Address(coord.getLng(), coord.getLat(), callback);
        }
    });

        document.getElementById("curruntPosition_btn").addEventListener("click", (e) => {
            const curruntPosition=$("#curruntPosition");
            function success(pos) { // 위치 정보를 가져오는데 성공했을 때 호출되는 콜백 함수 (pos : 위치 정보 객체)
                getMyPosition(pos.coords.latitude, pos.coords.longitude);
            }

            function fail(err) { // 위치 정보를 가져오는데 실패했을 때 호출되는 콜백 함수
                alert('현위치를 찾을 수 없습니다.');
            }

            navigator.geolocation.getCurrentPosition(success, fail);

            function getMyPosition(lat, lng){
                $('input[name=lat]').attr('value',lat);
                $('input[name=lng]').attr('value',lng);
                const myAround=document.getElementById('curruntPosition');
                myAround.submit();
            }
        });
</script>


