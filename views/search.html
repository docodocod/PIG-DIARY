{% block content %}
<head>
    <title>search</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="/search.css">
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<!--    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>-->
</head>
<div class="title-container">
    <h1 class="title">검색해주세요.</h1>
    <h1 class="title-down">찾아볼까요?</h1>
</div>
<fieldset class="field-container">
    <form id="search" action="/searchPage" method="post">
        <input type="text" name="searchWord" placeholder="Search..." class="field" />
        <input type="submit" />
    </form>
    <div class="icons-container">
        <div class="icon-search"></div>
        <div class="icon-close">
            <div class="x-up"></div>
            <div class="x-down"></div>
        </div>
    </div>
    <form id="myPosition" action="/searchPage" method="post">
        <input type="hidden" id="position" name="searchWord" value="" />
        <input type="submit" id="myPosition" />
    </form>
</fieldset>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=22382396d3cba032b99b1fcc9ec5b4f1&libraries=services"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    const field=$('.field');
    $(document).on("ready", function () {
        field.on("focus", function () {
            $("body").addClass("is-focus");
        });

        field.on("blur", function () {
            $("body").removeClass("is-focus is-type");
        });

        field.on("keydown", function (event) {
            $('body').addClass("is-type");
            if (event.which === 8 && $(this).val() === "") {
                $("body").removeClass("is-type");
            }
        });
    });

    document.getElementById("myPosition").addEventListener("click",(e)=>{
        e.preventDefault();
        function success(pos) { // 위치 정보를 가져오는데 성공했을 때 호출되는 콜백 함수 (pos : 위치 정보 객체)
            getMyPosition(pos.coords.latitude,pos.coords.longitude);
        }
        function fail(err) { // 위치 정보를 가져오는데 실패했을 때 호출되는 콜백 함수
            alert('현위치를 찾을 수 없습니다.');
        }
        navigator.geolocation.getCurrentPosition(success,fail);
        function getMyPosition(lat, lng){
            console.log(lat,lng);
            var geocoder = new kakao.maps.services.Geocoder();

            var coord = new kakao.maps.LatLng(lat, lng);
            var callback = function(result, status) {
                if (status === kakao.maps.services.Status.OK) {
                    const position=document.getElementById("position");
                    const name=result[0].address.address_name+" 맛집";
                    position.value=name;
                    const myPosition = document.getElementById('myPosition');
                    myPosition.submit();
                }
            };
            geocoder.coord2Address(coord.getLng(), coord.getLat(), callback);
        }
    })
</script>
{% endblock %}

